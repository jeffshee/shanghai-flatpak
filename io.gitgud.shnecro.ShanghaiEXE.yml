id: io.gitgud.shnecro.ShanghaiEXE
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
# runtime: org.kde.Platform
# runtime-version: '5.15-23.08'
# sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.mono6
command: ShanghaiEXE.exe
modules:
  - name: krb5
    buildsystem: simple
    build-commands:
      - autoreconf
      - ./configure --prefix=/app
      - make -j $FLATPAK_BUILDER_N_JOBS
      - make install
    subdir: src
    sources:
      - type: git
        url: https://github.com/krb5/krb5.git
        tag: krb5-1.21.2-final
        commit: 835f6e3d819beb7ee1046f01afb284b54ad54c5f
  - name: libjpeg # with libjpeg.so.8
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_SKIP_RPATH:BOOL=YES
      - -DENABLE_STATIC:BOOL=NO
      - -DWITH_JPEG8:BOOL=YES
      - -DWITH_TURBOJPEG:BOOL=NO
      - -DCMAKE_INSTALL_LIBDIR=/app/lib # uses lib64 by default
    cleanup: [/share, /bin]
    sources:
      - type: archive
        url: https://github.com/libjpeg-turbo/libjpeg-turbo/archive/refs/tags/2.1.3.tar.gz
        sha256: dbda0c685942aa3ea908496592491e5ec8160d2cf1ec9d5fd5470e50768e7859
  - name: libtiff5
    buildsystem: cmake
    sources:
      - type: archive
        url: https://download.osgeo.org/libtiff/tiff-4.4.0.tar.gz
        sha256: 917223b37538959aca3b790d2d73aa6e626b688e02dcda272aec24c2f498abed
  - name: libmd
    sources:
      - type: archive
        url: https://libbsd.freedesktop.org/releases/libmd-1.1.0.tar.xz
        sha256: 1bd6aa42275313af3141c7cf2e5b964e8b1fd488025caf2f971f43b00776b332
        x-checker-data:
          type: anitya
          project-id: 15525
          stable-only: true
          url-template: https://libbsd.freedesktop.org/releases/libmd-$version.tar.xz
  - name: libbsd
    sources:
      - type: archive
        url: https://libbsd.freedesktop.org/releases/libbsd-0.12.2.tar.xz
        sha256: b88cc9163d0c652aaf39a99991d974ddba1c3a9711db8f1b5838af2a14731014
        x-checker-data:
          type: anitya
          project-id: 1567
          stable-only: true
          url-template: https://libbsd.freedesktop.org/releases/libbsd-$version.tar.xz
  - name: libgdiplus
    sources:
      - type: archive
        url: https://download.mono-project.com/sources/libgdiplus/libgdiplus-6.1.tar.gz
        sha256: 97d5a83d6d6d8f96c27fb7626f4ae11d3b38bc88a1726b4466aeb91451f3255b
  - name: mono
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/mono6/install.sh
  - name: shanghai-exe
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - tar -xvf ShanghaiEXE_05XXeWIPX_Linux.tar.gz -C /app/bin
    cleanup:
      - ShanghaiEXE_05XXeWIPX_Linux.tar.gz
    sources:
      - type: file
        path: ShanghaiEXE_05XXeWIPX_Linux.tar.gz
        # url: https://gitgud.io/SHNecro/shanghaiexe/uploads/87b344807ea7b145b1f2ac9c37819aa5/ShanghaiEXE_05XXeWIPX_Linux.tar.gz
        # sha256: 1b1496d235639926d8a164876fca7581afb45b5e566959e22a28e94033da9622